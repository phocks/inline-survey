import "./keyshape.min";

// Make sure KeyshapeJS is in global
if (KeyshapeJS.version.indexOf("1.") != 0)
  throw Error("Expected KeyshapeJS v1.*.*");
window.ks = document.ks = KeyshapeJS;

import React from "react";
import SVG from "react-inlinesvg";
import { Portal } from "react-portal";
import styles from "./styles.scss";

import faceAnimation from "./Face.svg";
import cloudAnimation from "./cloud.svg";

const clouds = [
  { name: "cloud1" },
  { name: "cloud2" },
  { name: "cloud3" },
  { name: "cloud4" }
];

export default props => {
  const initImages = () => {
    console.log("init");
  };

  const animateCloud = cloudName => {
    if (KeyshapeJS.version.indexOf("1.") != 0)
      throw Error("Expected KeyshapeJS v1.*.*");
    window.ks = document.ks = KeyshapeJS;
    (function(ks) {
      ks.animate(
        `#Back__${cloudName}`,
        [
          {
            p: "d",
            t: [0, 4000, 8000],
            v: [
              "path('M4.59414,43.6929C4.59414,43.6929,4.97904,43.0593,5.62378,42.0569C6.22131,41.1278,7.04202,39.882,7.98634,38.5302C10.9856,34.2351,15.2289,28.8717,17.5222,29.2C21.5597,29.7763,19.979,35.3816,21.2158,34.7031C22.4535,34.0243,36.1833,18.0522,41.4561,18.0531C48.5688,18.0528,46.6213,33.1142,48.8683,33.5403C51.1143,33.9669,57.4196,25.2465,61.4859,25.1936C67.142,25.1199,64.8246,34.184,68.8476,34.7025C72.8701,35.2224,77.2795,31.3745,80.8903,31.2569C84.755,30.9,85.0551,37.25,85.755,37.25C88.2532,37.25,88.9301,35,92.521,34.7028C96.255,34.7028,93.8486,38.7,95.6801,38.7C101.864,38.7,102.685,42.0602,101.864,42.0158C99.0531,41.8623,74.402,44.4399,62.4862,44.4398C50.5704,44.4397,39.17,41.8722,32.406,41.873C17.349,41.8723,4.59414,43.6929,4.59414,43.6929Z')",
              "path('M4.594,43.693C4.594,43.693,6.10673,40.7346,8.09265,38.1442C9.93317,35.7434,12.1801,33.6587,14.006,34.538C20.309,37.574,22.983,23.548,28.611,23.441C32.689,23.364,32.025,30.295,34.795,30.315C37.596,30.336,45.592,22.463,50.866,22.463C57.978,22.463,55.267,33.347,59.398,33.362C63.062,33.375,68.87,29.002,72.937,28.979C79.16,28.943,75.902,37.262,78.908,37.535C82.132,37.827,84.359,33.714,87.4,33.362C89.2859,33.1429,90.8565,35.72,92.4801,36.586C94.1168,37.459,95.805,36.6216,97.314,36.586C100.08,36.2333,100.072,39.6209,100.78,40.4C102.238,42.0035,102.113,42.0029,101.864,42.015C99.052,42.154,74.402,44.44,62.486,44.44C50.571,44.44,39.17,41.873,32.406,41.873C17.35,41.873,4.594,43.693,4.594,43.693Z')",
              "path('M4.594,43.693C4.594,43.693,13.4135,29.2,17.205,29.2C21.405,29.2,20.155,34.9416,21.105,34.725C22.055,34.5084,35.7353,18.1237,41.3634,18.0167C48.9134,18.0167,46.4801,33.5333,48.8967,33.5333C51.4967,33.5333,57.3467,25.2,61.5467,25.2C67.1801,24.9833,64.849,34.735,68.9801,34.75C74.7968,34.75,76.8631,31.273,80.9301,31.25C85.2467,31.25,84.5551,37.25,85.6967,37.25C88.6134,36.4167,89.4057,35.102,92.4467,34.75C94.3326,34.5309,94.8954,35.4619,95.0551,36.45C95.216,37.446,94.969,38.5,95.6467,38.5C98.38,38.7,99.6054,39.3475,100.605,39.875C102.405,40.825,102.38,42.015,101.864,42.015C98.9467,41.8667,74.402,44.44,62.486,44.44C50.571,44.44,39.17,41.873,32.406,41.873C17.35,41.873,4.594,43.693,4.594,43.693Z')"
            ],
            e: [[0], [0], [0]],
            iterations: Infinity
          }
        ],
        `#Middle__${cloudName}`,
        [
          {
            p: "d",
            t: [0, 4000, 8000],
            v: [
              "path('M4.59414,43.6929C4.59414,43.6929,4.97904,43.0593,5.62378,42.0569C6.22131,41.1278,7.04202,39.882,7.98634,38.5302C10.9856,34.2351,15.2289,28.8717,17.5222,29.2C21.5597,29.7763,19.979,35.3816,21.2158,34.7031C22.4535,34.0243,36.1833,18.0522,41.4561,18.0531C48.5688,18.0528,46.6213,33.1142,48.8683,33.5403C51.1143,33.9669,57.4196,25.2465,61.4859,25.1936C67.142,25.1199,64.8246,34.184,68.8476,34.7025C72.8701,35.2224,77.2795,31.3745,80.8903,31.2569C84.755,30.9,85.0551,37.25,85.755,37.25C88.2532,37.25,88.9301,35,92.521,34.7028C96.255,34.7028,93.8486,38.7,95.6801,38.7C101.864,38.7,102.685,42.0602,101.864,42.0158C99.0531,41.8623,74.402,44.4399,62.4862,44.4398C50.5704,44.4397,39.17,41.8722,32.406,41.873C17.349,41.8723,4.59414,43.6929,4.59414,43.6929Z')",
              "path('M4.594,43.693C4.594,43.693,6.10673,40.7346,8.09265,38.1442C9.93317,35.7434,12.1801,33.6587,14.006,34.538C20.309,37.574,22.983,23.548,28.611,23.441C32.689,23.364,32.025,30.295,34.795,30.315C37.596,30.336,45.592,22.463,50.866,22.463C57.978,22.463,55.267,33.347,59.398,33.362C63.062,33.375,68.87,29.002,72.937,28.979C79.16,28.943,75.902,37.262,78.908,37.535C82.132,37.827,84.359,33.714,87.4,33.362C89.2859,33.1429,90.8565,35.72,92.4801,36.586C94.1168,37.459,95.805,36.6216,97.314,36.586C100.08,36.2333,100.072,39.6209,100.78,40.4C102.238,42.0035,102.113,42.0029,101.864,42.015C99.052,42.154,74.402,44.44,62.486,44.44C50.571,44.44,39.17,41.873,32.406,41.873C17.35,41.873,4.594,43.693,4.594,43.693Z')",
              "path('M4.594,43.693C4.594,43.693,13.4135,29.2,17.205,29.2C21.405,29.2,20.155,34.9416,21.105,34.725C22.055,34.5084,35.7353,18.1237,41.3634,18.0167C48.9134,18.0167,46.4801,33.5333,48.8967,33.5333C51.4967,33.5333,57.3467,25.2,61.5467,25.2C67.1801,24.9833,64.849,34.735,68.9801,34.75C74.7968,34.75,76.8631,31.273,80.9301,31.25C85.2467,31.25,84.5551,37.25,85.6967,37.25C88.6134,36.4167,89.4057,35.102,92.4467,34.75C94.3326,34.5309,94.8954,35.4619,95.0551,36.45C95.216,37.446,94.969,38.5,95.6467,38.5C98.38,38.7,99.6054,39.3475,100.605,39.875C102.405,40.825,102.38,42.015,101.864,42.015C98.9467,41.8667,74.402,44.44,62.486,44.44C50.571,44.44,39.17,41.873,32.406,41.873C17.35,41.873,4.594,43.693,4.594,43.693Z')"
            ],
            e: [[0], [0], [0]],
            iterations: Infinity
          }
        ],
        `#Front__${cloudName}`,
        [
          {
            p: "d",
            t: [0, 4000, 8000],
            v: [
              "path('M4.59414,43.6929C4.59414,43.6929,4.97904,43.0593,5.62378,42.0569C6.22131,41.1278,7.04202,39.882,7.98634,38.5302C10.9856,34.2351,15.2289,28.8717,17.5222,29.2C21.5597,29.7763,19.979,35.3816,21.2158,34.7031C22.4535,34.0243,36.1833,18.0522,41.4561,18.0531C48.5688,18.0528,46.6213,33.1142,48.8683,33.5403C51.1143,33.9669,57.4196,25.2465,61.4859,25.1936C67.142,25.1199,64.8246,34.184,68.8476,34.7025C72.8701,35.2224,77.2795,31.3745,80.8903,31.2569C84.755,30.9,85.0551,37.25,85.755,37.25C88.2532,37.25,88.9301,35,92.521,34.7028C96.255,34.7028,93.8486,38.7,95.6801,38.7C101.864,38.7,102.685,42.0602,101.864,42.0158C99.0531,41.8623,74.402,44.4399,62.4862,44.4398C50.5704,44.4397,39.17,41.8722,32.406,41.873C17.349,41.8723,4.59414,43.6929,4.59414,43.6929Z')",
              "path('M4.594,43.693C4.594,43.693,6.10673,40.7346,8.09265,38.1442C9.93317,35.7434,12.1801,33.6587,14.006,34.538C20.309,37.574,22.983,23.548,28.611,23.441C32.689,23.364,32.025,30.295,34.795,30.315C37.596,30.336,45.592,22.463,50.866,22.463C57.978,22.463,55.267,33.347,59.398,33.362C63.062,33.375,68.87,29.002,72.937,28.979C79.16,28.943,75.902,37.262,78.908,37.535C82.132,37.827,84.359,33.714,87.4,33.362C89.2859,33.1429,90.8565,35.72,92.4801,36.586C94.1168,37.459,95.805,36.6216,97.314,36.586C100.08,36.2333,100.072,39.6209,100.78,40.4C102.238,42.0035,102.113,42.0029,101.864,42.015C99.052,42.154,74.402,44.44,62.486,44.44C50.571,44.44,39.17,41.873,32.406,41.873C17.35,41.873,4.594,43.693,4.594,43.693Z')",
              "path('M4.594,43.693C4.594,43.693,13.4135,29.2,17.205,29.2C21.405,29.2,20.155,34.9416,21.105,34.725C22.055,34.5084,35.7353,18.1237,41.3634,18.0167C48.9134,18.0167,46.4801,33.5333,48.8967,33.5333C51.4967,33.5333,57.3467,25.2,61.5467,25.2C67.1801,24.9833,64.849,34.735,68.9801,34.75C74.7968,34.75,76.8631,31.273,80.9301,31.25C85.2467,31.25,84.5551,37.25,85.6967,37.25C88.6134,36.4167,89.4057,35.102,92.4467,34.75C94.3326,34.5309,94.8954,35.4619,95.0551,36.45C95.216,37.446,94.969,38.5,95.6467,38.5C98.38,38.7,99.6054,39.3475,100.605,39.875C102.405,40.825,102.38,42.015,101.864,42.015C98.9467,41.8667,74.402,44.44,62.486,44.44C50.571,44.44,39.17,41.873,32.406,41.873C17.35,41.873,4.594,43.693,4.594,43.693Z')"
            ],
            e: [[0], [0], [0]],
            iterations: Infinity
          }
        ],
        `#Mask__${cloudName}`,
        [
          {
            p: "d",
            t: [0, 4000, 8000],
            v: [
              "path('M4.59414,43.6929C4.59414,43.6929,4.97904,43.0593,5.62378,42.0569C6.22131,41.1278,7.04202,39.882,7.98634,38.5302C10.9856,34.2351,15.2426,28.4967,17.5359,28.825C21.5734,29.4013,20.8496,27.2001,22.0864,26.5216C23.3241,25.8428,36.0297,17.4241,41.3025,17.425C48.4152,17.4247,49.9889,19.1213,52.2359,19.5474C54.4819,19.974,57.4696,24.4029,61.5359,24.35C67.192,24.2763,68.2251,24.6751,72.2481,25.1936C76.2706,25.7135,77.3584,30.7176,80.9692,30.6C84.8339,30.2431,92.2826,31.56,92.9825,31.56C95.4807,31.56,94.8219,38.4415,95.1692,38.64C96.2892,39.28,99.3292,38.68,101.236,40.125C101.781,40.4366,102.685,42.0602,101.864,42.0158C99.0531,41.8623,74.402,44.4399,62.4862,44.4398C50.5704,44.4397,39.17,41.8722,32.406,41.873C17.349,41.8723,4.59414,43.6929,4.59414,43.6929Z')",
              "path('M4.594,43.693C4.594,43.693,6.2894,40.4462,8.32046,37.9206C10.22,35.5798,12.3795,33.6908,14.1835,34.5427C20.3527,37.4974,23.3018,23.4124,28.9298,23.3054C33.0946,23.2303,33.3148,25.7805,36.0759,25.8C38.8719,25.8204,45.8859,22.5314,51.133,22.5314C58.2081,22.526,58.355,26.745,62.486,26.76C66.2038,26.7727,69.0698,29.0588,73.1368,29.0358C79.3122,29.0007,78.9831,31.0138,81.9425,31.28C85.1588,31.5438,84.4852,33.7487,87.5262,33.3967C89.4121,33.1776,91.8222,33.3309,93.4092,34.2C95.009,35.0761,97.041,38.1948,98.5292,38.16C100.823,39.84,99.9999,39.6272,100.716,40.4C102.182,41.9871,102.12,42.0032,101.864,42.015C99.0494,42.1468,74.402,44.44,62.486,44.44C50.571,44.44,39.17,41.873,32.406,41.873C17.35,41.873,4.594,43.693,4.594,43.693Z')",
              "path('M4.59414,43.6929C4.59414,43.6929,4.97904,43.0593,5.62378,42.0569C6.22131,41.1278,7.04202,39.882,7.98634,38.5302C10.9856,34.2351,15.2426,28.4967,17.5359,28.825C21.5734,29.4013,20.8496,27.2001,22.0864,26.5216C23.3241,25.8428,36.0297,17.4241,41.3025,17.425C48.4152,17.4247,49.9889,19.1213,52.2359,19.5474C54.4819,19.974,57.4696,24.4029,61.5359,24.35C67.192,24.2763,68.2251,24.6751,72.2481,25.1936C76.2706,25.7135,77.3584,30.7176,80.9692,30.6C84.8339,30.2431,92.2826,31.56,92.9825,31.56C95.4807,31.56,94.8219,38.4415,95.1692,38.64C96.2892,39.28,99.3292,38.68,101.236,40.125C101.781,40.4366,102.685,42.0602,101.864,42.0158C99.0531,41.8623,74.402,44.4399,62.4862,44.4398C50.5704,44.4397,39.17,41.8722,32.406,41.873C17.349,41.8723,4.59414,43.6929,4.59414,43.6929Z')"
            ],
            e: [[1, 0, 0, 1, 1], [0], [0]],
            iterations: Infinity
          }
        ],
        { autoremove: false }
      )
        .range(0, 7900)
        .loop(true);
      if (
        document.location.search
          .substr(1)
          .split("&")
          .indexOf("global=paused") >= 0
      )
        ks.globalPause();
    })(KeyshapeJS);
  };

  return (
    <Portal node={document.querySelector(".storylab-header-animation")}>
      <div className={styles.root}>
        <div className={styles.face}>
          <SVG
            src={faceAnimation}
            uniquifyIDs={true}
            uniqueHash="face"
            style={{}}
            onLoad={initImages}
          />
        </div>

        {clouds.map((cloud, iteration) => {
          return (
            <div className={styles.cloud} key={iteration}>
              <SVG
                src={cloudAnimation}
                uniquifyIDs={true}
                uniqueHash={cloud.name}
                style={{
                  position: "fixed",
                  width: 500 * Math.random() + 200 + "px",
                  top: window.innerHeight * Math.random() - 250 + "px",
                  left: window.innerWidth * Math.random() - 250 + "px"
                  // top: "0px",
                  // left: "0px"
                }}
                onLoad={() => {
                  setTimeout(() => {
                    animateCloud(cloud.name);
                  }, Math.random() * 1000);
                }}
              />
            </div>
          );
        })}
      </div>
    </Portal>
  );
};
